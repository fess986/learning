# запускается сборка имейджа коммандой в консоли 'docker build .' - где точка - это путь до места где хранится докерфайл, так как мы запускаем из локальной консоли, можно указать просто точку

# базировака имеджа. Если не будет локального образа node , то он автоматом скачается из интернета
FROM node 

# указываем рабочую папку в будущем имэдже
WORKDIR /app

# для кэширования перезаписи имэйджев сначала скопируем package.json и сделаем npm install, таким образом, если в нём ничего не поменялось, алгоритм докера не будет заново устанавливать всё с нуля
COPY package.json /app

# даем инструкции что сделать после выполнения копирования. RUN используется для сборки прокта
RUN npm install

# указываем что будет в нашем образе. В данном случае мы говорим скопировать всё из текущей папки файла с докфайлом в корень имэджа, или в текущую рабочую папку, как в нашем случае это /app
COPY . .

# явно указываем энвайренту порт по умолчанию 4200. То есть создаем переменную PORT
ENV PORT 3001

# не обязательная команда, указываем порт на котором будет запускаться наше приложение
# EXPOSE 3000 - начальная версия

EXPOSE $PORT 
# обращаемся к раннее объявленной переменной PORT

# можно указывать по переменной, указанной в ENV
EXPOSE $PORT

# при помощи VOLUME мы указываем место где можно хранить данные. Но если мы делаем именнованную метку через запуск(ран) контейнера, то это не обязательно писать, так как это игнорится системой
# VOLUME [ "/app/data3" ]

# используется для выполнения исполняемых консольных комманд. В нашем случае выполнится "node app.js"
CMD [ "node", "app.js" ]

